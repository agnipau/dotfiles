#!/usr/bin/env bash
#
# Script I use to finalize my Void Linux installation.


# Install b43 broadcom wireless driver (my laptop needs it, things may be different for you)
sudo xbps-install -S b43-fwcutter
export FIRMWARE_INSTALL_DIR="/usr/lib/firmware"
wget http://www.lwfinger.com/b43-firmware/broadcom-wl-5.100.138.tar.bz2
tar xjf broadcom-wl-5.100.138.tar.bz2
b43-fwcutter -w "$FIRMWARE_INSTALL_DIR" broadcom-wl-5.100.138/linux/wl_apsta.o


# Reinstall all the packages through the list generated by void-list-pkgs script
install() {
  [[ -f installed_pkgs ]] && sudo xbps-install -yS $(cat installed_pkgs)
  [[ ! -f installed_pkgs ]] && read -p "==> installed_pkgs not found. Specify its position (only the parent directory): " posizione
  cd $posizione
  [[ -f installed_pkgs ]] && sudo xbps-install -yS $(cat installed_pkgs)
  [[ ! -f installed_pkgs ]] && echo "==> Not valid directory, retry..." && sleep 2s && install
}
install


echo "==> All the packages have been restored succesfully"


# Configure wireless connection
read -p "==> Enter the SSID of your network: " essid
read -p "==> Enter the password of your network: " pass
read -p "==> Enter the name of your wireless interface: " wireless_interface
sudo -i
wpa_passphrase $essid $pass >> /etc/wpa_supplicant/wpa_supplicant.conf
echo WPA_INTERFACE=$wireless_interface > /etc/sv/wpa_supplicant/conf


echo "==> Configuration finished :)"
