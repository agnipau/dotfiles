#!/usr/bin/env bash
#
# Script executed by pywal.

set -x

# shellcheck source=/dev/null
. "${HOME}/.cache/wal/colors.sh"

reload_dunst() {
  killall -9 dunst
  dunst \
    -lb "${color0:-#000000}" \
    -nb "${color0:-#000000}" \
    -cb "${color1:-#ff0000}" \
    -lf "${color7:-#ffffff}" \
    -nf "${color7:-#ffffff}" \
    -cf "${color0:-#000000}" \
    -lfr "${color0:-#000000}" \
    -nfr "${color0:-#000000}" \
    -cfr "${color1:-#ff0000}" &
}

reload_zathura() {
  cat <<EOF >"${HOME}/.cache/wal/colors-zathura"
set default-bg "${color0:-#000000}"
set default-fg "${color7:-#ffffff}"
set completion-bg "${color0:-#000000}"
set completion-fg "${color7:-#ffffff}"
set completion-highlight-bg "${color1:-#ff0000}"
set completion-highlight-fg "${color0:-#000000}"
set statusbar-bg "${color1:-#ff0000}"
set statusbar-fg "${color0:-#000000}"
set inputbar-bg "${color0:-#000000}"
set inputbar-fg "${color7:-#ffffff}"
EOF
}

reload_openbox() {
  sed -i --follow-symlinks \
      -e "s/bg.color: #.*/bg.color: ${color1:-#000000}/" \
      -e "s/text.color: #.*/text.color: ${color0:-#ffffff}/" \
      -e "s/image.color: #.*/image.color: ${color0:-#ffffff}/" \
      "${HOME}/.themes/thicc/openbox-3/themerc"
  openbox --reconfigure
}

reload_colors() {
  old_string="--color fg:7,bg:0,hl:1,fg+:232,bg+:1,hl+:255"
  new_string="--color fg:7,hl:1,fg+:232,bg+:1,hl+:255"
  sed -i -e "s/$old_string/$new_string/" \
         "${HOME}/.cache/wal/colors.sh"
}

reload_rofi() {
  sed -i -e "33i\ \ \ \ border-radius: 5;" \
         "${HOME}/.cache/wal/colors-rofi-dark.rasi"
  sed -i -e "s/selected-normal-foreground: @.*/selected-normal-foreground: @background;/" \
         "${HOME}/.cache/wal/colors-rofi-dark.rasi"
}

# Change the value of color17 and the value of color18
add_colors_variants() {
  . "${HOME}/.cache/wal/colors.sh"
  for term in /dev/pts/[0-9]*; do
    if [[ -w "$term" ]]; then
      printf "\e]4;17;rgb:${color0_lighter_40:1:2}/${color0_lighter_40:3:2}/${color0_lighter_40:5:2}\e\\" > "$term"
      #printf "\033]4;17;rgb:${color0_lighter_40:1:2}/${color0_lighter_40:3:2}/${color0_lighter_40:5:2}\007" > "$term"
      printf "\e]4;18;rgb:${color0_lighter_60:1:2}/${color0_lighter_60:3:2}/${color0_lighter_60:5:2}\e\\" > "$term"
      #printf "\033]4;18;rgb:${color0_lighter_60:1:2}/${color0_lighter_60:3:2}/${color0_lighter_60:5:2}\007" > "$term"
    fi
  done
}

main() {
  reload_dunst
  reload_zathura
  reload_openbox
  reload_colors
  reload_rofi
  "${HOME}/progetti/wal-telegram/wal-telegram"
  "${HOME}/altri_progetti/wal-discord/wal-discord"
  "${HOME}/bin/extend_pywal"
  add_colors_variants
}

main
