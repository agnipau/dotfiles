#!/usr/bin/env bash
#
# xbacklight doesn't work with my nvidia gpu so I wrote this script.
# xbacklight doesn't wokrk, but I can still manually change the content of
# /sys/class/backlight/intel_backlight/brightness, so this script automatize the
# process of changing the value of this file.

abr="$(</sys/class/backlight/intel_backlight/brightness)"
mbr="$(</sys/class/backlight/intel_backlight/max_brightness)"
prc="$2"

dec() {
  (( abr -= $((abr * prc / 100)) ))
  printf '%s\n' "$abr" > /sys/class/backlight/intel_backlight/brightness
}

inc() {
  (( abr += $((abr * prc / 100)) ))
  [[ "$abr" -ge "$mbr" ]] && \
    printf '%s\n' "$mbr" > /sys/class/backlight/intel_backlight/brightness
  [[ "$abr" -lt "$mbr" ]] && \
    printf '%s\n' "$abr" > /sys/class/backlight/intel_backlight/brightness
}

max() {
  printf '%s\n' "$mbr" > /sys/class/backlight/intel_backlight/brightness
}

# Quite useless but it works
min() {
  printf '%s\n' "0" > /sys/class/backlight/intel_backlight/brightness
}

current() {
  mbr="$((mbr / 100))"
  printf '%s\n' "$((abr / mbr - 1))%"
}

[[ "$1" == --dec ]]     && dec
[[ "$1" == --inc ]]     && inc
[[ "$1" == --max ]]     && max
[[ "$1" == --min ]]     && min
[[ "$1" == --current ]] && current
