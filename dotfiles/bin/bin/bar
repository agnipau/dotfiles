#!/usr/bin/env bash
#
# Converted polybar into tmux status line.
# Modified version of bar script by Dylan Araps.

lum() {
  lum_gre="$(bc -l <<<"$(</sys/class/backlight/intel_backlight/brightness) \
    / $(</sys/class/backlight/intel_backlight/max_brightness) * 100")"

  if [[ "${lum_gre:3:1}" == "." ]]; then
    lum="100% \\uf0eb"
  elif [[ "${lum_gre:2:1}" == "." ]]; then
    lum="${lum_gre:0:2}% \\uf0eb"
  elif [[ "${lum_gre:1:1}" == "." ]]; then
    lum="${lum_gre:0:1}% \\uf0eb"
  fi
}

vol() {
  cvo_gre="$(amixer sget Master | tail -n1 | cut -d' ' -f6)"
  cvo="${cvo_gre:1:3}"
  
  if [[ "${cvo:2}" = % ]]; then
    cvo="${cvo:0:2}"
  elif [[ "${cvo:2}" = 0 ]]; then
    cvo="${cvo:0:3}"
  else
    cvo="${cvo:0:1}"
  fi

  if [[ "$cvo" -ge 50 ]]; then
    vol="${cvo}% \\uf028"
  elif [[ "$cvo" -gt 0 ]]; then
    vol="${cvo}% \\uf027"
  elif [[ "$cvo" -eq 0 ]]; then
    vol="${cvo}% \\uf026"
  fi
}

ssid() {
  ssid="$(iwgetid -r) \\uf1eb"
}

bat() {
  sta="$(</sys/class/power_supply/BAT0/status)"
  cap="$(</sys/class/power_supply/BAT0/capacity)"

  if [[ "$cap" -eq 100 ]]; then
    bat="${cap}% \\uf240"
  elif [[ "$cap" -ge 75 ]]; then
    bat="${cap}% \\uf241"
  elif [[ "$cap" -ge 50 ]]; then
    bat="${cap}% \\uf242"
  elif [[ "$cap" -ge 25 ]]; then
    bat="${cap}% \\uf243"
  elif [[ "$cap" -ge 0 ]]; then
    bat="${cap}% \\uf244"
  fi

  [[ "$sta" == Charging ]] && \
    bat+="  \\uf0e7"
}

ore() {
  ore="$(printf "%(%a %d %H:%M)T" "-1") \\uf017"
}

if (("${1:-148}" >= 147)); then
  lum
  vol
  ssid
  bat
  ore
  [[ "$sta" == Discharging ]] && \
    printf '%b\n' "$lum  $vol   $ssid   $bat    $ore "
  [[ "$sta" == Charging ]] && \
    printf '%b\n' "$lum  $vol   $ssid   $bat   $ore "
fi
